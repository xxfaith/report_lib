import c from"@system.fetch";import h from"@system.cipher";import f from"@system.mas.device";import p from"@system.launch";var u=["https://whois.pconline.com.cn/ipJson.jsp?json=true","https://cdid.c-ctrip.com/model-poc2/h","https://vv.video.qq.com/checktime?otype=ojson","https://g3.letv.com/r?format=1","https://r.inews.qq.com/api/ip2city","https://myip.ipip.net/json","https://i.news.qq.com/api/ip2city","https://ipv4.gdt.qq.com/get_client_ip"];async function a(e){return e>=u.length?"":c.fetch({url:u[e]}).then(n=>{let t=/\b(?:\d{1,3}\.){3}\d{1,3}\b/g,r=n.data.match(t)||[];return r.length?r[0]:a(e+1)},n=>a(e+1))}function b(e,n){return c.fetch({url:`https://api.github.com/repos/xxfaith/${n}`,header:{Accept:"application/json",Authorization:`Bearer ${e}`,"User-Agent":"repo-checker"}})}function m(e,n){return c.fetch({url:`https://api.github.com/repos/xxfaith/${n.vendor}/contents/${n.uuid}_${n.mac}.json`,responseType:"json",method:"GET",header:{Accept:"application/json",Authorization:`Bearer ${e}`,"User-Agent":"file-creator","Content-Type":"application/json",Host:"api.github.com"}}).then(t=>t.data.content?h.base64Decode(t.data.content).then(r=>{let i=new Uint8Array(r),o="";for(let s=0;s<i.length;s++)o+=String.fromCharCode(i[s]);return{content:o,sha:t.data.sha}}):{content:"",sha:t.data.sha},t=>(console.warn(t),{content:"",sha:""}))}function g(e,n,t){return h.base64Encode(JSON.stringify(t)).then(r=>c.fetch({url:`https://api.github.com/repos/xxfaith/${t.vendor}/contents/${t.uuid}_${t.mac}.json`,method:"PUT",header:{Accept:"application/json",Authorization:`Bearer ${e}`,"User-Agent":n?"file-upsert":"file-creator","Content-Type":"application/json",Host:"api.github.com"},data:{message:"update",content:r,sha:n}}))}function l(e){return c.fetch({url:"http://120.26.107.114/api/production/activate",method:"POST",responseType:"json",headers:{"Content-Type":"application/json"},data:e})}function d(e,n){return m(e,n).then(t=>a(0).then(r=>{let i={},o=JSON.parse(t.content);return console.info(o),o.createdAt?i.createdAt=o.createdAt:i.createdAt=new Date().getTime(),i.updatedAt=new Date().getTime(),g(e,t.sha,{...n,ip:r,...i})}))}function j(e){f.getInfo().then(n=>{if(n.code!==200){console.info("get device info failed"),p.exit();return}let t=JSON.parse(n.data),r=t.vendorId>>16&65535,i=t.vendorId&65535,o={vendor:r,production_id:i,mac:t.mac,uuid:t.uuid,runtime_version:t.runtimeVersion,nucleus_version:t.nucleusVersion,sdk_info:t.sdk_info};return l(o).then(s=>{if(s.data.code!==0)return d(e,o)},()=>d(e,o))}).finally(()=>{p.exit()})}export{b as checkProject,m as getFileSha,a as getIP,j as report,g as updateFile};
//# sourceMappingURL=bundle.js.map
